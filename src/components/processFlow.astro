---
import { Image } from 'astro:assets'
import { getLocale } from 'astro-i18n-aut'
import car0 from 'assets/carousel/carousel_0.jpg'
import car1 from 'assets/carousel/carousel_1.jpg'
import car2 from 'assets/carousel/carousel_2.jpg'
import car5 from 'assets/carousel/carousel_5.jpg'

const locale = getLocale(Astro.url)

const copy = {
  en: {
    title: 'From drawing to delivered part.',
    body:
      'Clear process, direct communication, and inspection data attached to every batch.',
    stepLabel: 'Step',
    steps: [
      {
        id: '01',
        title: 'RFQ Review',
        note: 'We validate geometry, material, and tolerance stack-up.',
        image: car2,
      },
      {
        id: '02',
        title: 'Production Plan',
        note: 'Tooling, fixtures, and operation sequence are prepared.',
        image: car0,
      },
      {
        id: '03',
        title: 'Machining',
        note: 'CNC milling and turning with in-process checks.',
        image: car1,
      },
      {
        id: '04',
        title: 'Inspection + Dispatch',
        note: 'Final QC protocol and protected shipment.',
        image: car5,
      },
    ],
  },
  sk: {
    title: 'Od výkresu po dodaný diel.',
    body:
      'Jasný postup, priama komunikácia a výstupná kontrola pri každej sérii.',
    stepLabel: 'Krok',
    steps: [
      {
        id: '01',
        title: 'Kontrola dopytu',
        note: 'Overíme geometriu, materiál a tolerančný reťazec.',
        image: car2,
      },
      {
        id: '02',
        title: 'Plán výroby',
        note: 'Pripravíme náradie, prípravky a technologický postup.',
        image: car0,
      },
      {
        id: '03',
        title: 'Obrábanie',
        note: 'CNC frézovanie a sústruženie s medzioperáciovou kontrolou.',
        image: car1,
      },
      {
        id: '04',
        title: 'Kontrola + expedícia',
        note: 'Výstupný protokol kvality a bezpečné balenie.',
        image: car5,
      },
    ],
  },
}

const t = copy[locale] || copy.en
---

<section class="pb-16">
  <div class="mx-auto max-w-screen-xl px-5">
    <div class="max-w-2xl">
      <h2 class="text-3xl font-display font-semibold tracking-tight text-slate-900 lg:text-5xl">
        {t.title}
      </h2>
      <p class="mt-4 text-lg text-slate-600">{t.body}</p>
    </div>

    <div class="mt-10 grid grid-cols-1 gap-5 md:grid-cols-2 xl:grid-cols-4">
      {
        t.steps.map((step, idx) => (
          <article class={`process-card process-card-${idx + 1} reveal-card`}>
            <Image
              src={step.image}
              alt={step.title}
              width={360}
              height={220}
              fit="cover"
              loading="lazy"
              class="h-40 w-full object-cover"
            />
            <div class="p-5">
              <p class="text-[11px] font-semibold uppercase tracking-[0.2em] text-slate-500">
                {t.stepLabel} {step.id}
              </p>
              <h3 class="mt-2 text-lg font-semibold text-slate-900">{step.title}</h3>
              <p class="mt-2 text-sm leading-relaxed text-slate-600">{step.note}</p>
            </div>
          </article>
        ))
      }
    </div>
  </div>
</section>

<script>
  const reveals = document.querySelectorAll('.reveal-card')
  const io = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible')
          io.unobserve(entry.target)
        }
      })
    },
    { threshold: 0.22 }
  )
  reveals.forEach((item) => io.observe(item))
</script>

<style>
  .process-card {
    overflow: hidden;
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.3);
    background: rgba(255, 255, 255, 0.76);
    box-shadow: 0 18px 36px -34px rgba(15, 23, 42, 0.55);
    opacity: 0;
    transform: translateY(14px);
    transition: transform 420ms ease, opacity 420ms ease, box-shadow 220ms ease;
  }

  .process-card.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .process-card:hover {
    box-shadow: 0 26px 45px -36px rgba(15, 23, 42, 0.62);
  }

  .process-card-2 {
    animation-delay: 0.08s;
  }

  .process-card-3 {
    animation-delay: 0.16s;
  }

  .process-card-4 {
    animation-delay: 0.24s;
  }

  @media (prefers-reduced-motion: reduce) {
    .process-card {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>
